foreach ($profile in (netsh wlan show profiles | Select-String 'All User Profile' | ForEach-Object { $_ -replace 'All User Profile\s+:\s+', '' })) { $keyResult = netsh wlan show profile name=`"$profile`" key=clear; $keyContent = $keyResult | Select-String 'Key content'; if ($keyContent) { $key = ($keyContent -split ':')[1].Trim(); Write-Output ('Profile Name: ' + $profile); Write-Output ('Wi-Fi Key: ' + $key) } }